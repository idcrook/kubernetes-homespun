# traefik.toml -*- toml -*-

# See https://docs.traefik.io/configuration/acme/
#     https://docs.traefik.io/user-guide/kubernetes/
#     https://docs.traefik.io/configuration/entrypoints/

# using ACME (via Let's Encrypt)
defaultEntryPoints = ["http","https"]
[entryPoints]
  [entryPoints.http]
    address = ":80"
    compress = true
    [entryPoints.http.redirect]
      entryPoint = "https"
  [entryPoints.https]
    address = ":443"
    compress = true
    [entryPoints.https.tls]
  [entryPoints.dashboard]
    address = ":8081"

[api]
  dashboard = true
  entryPoint = "dashboard"
  [api.statistics]
    recentErrors = 10

[accessLog]

[kubernetes]

[ping]
entryPoint = "http"

# Enable ACME (Let's Encrypt): automatic SSL
#
[acme]
email = "david.crook@gmail.com"
storage = "/acme/acme.json"
entryPoint = "https"
acmeLogging = true
#onDemand = true
OnHostRule = true
#caServer = "https://acme-staging-v02.api.letsencrypt.org/directory"
# CA server to use
# Uncomment the line to run on the staging let's encrypt server
# Leave comment to go to prod
#
[acme.httpChallenge]
    entryPoint = "http"

# placeholder toward DNS challenge (and wilcards)
# needs envariables to be executed for each provider
# [acme.dnsChallenge]
#     entryPoint = "https"
#     provider = "namecheap"
#     delayBeforeCheck = 0


# HTTP challenge
[[acme.domains]]
   main = "crookster.org"
   sans = ["www.crookster.org", "data.crookster.org", "mqtt.crookster.org", "miniflux.crookster.org" ]
[[acme.domains]]
   main = "idcrook.com"
   sans = ["www.idcrook.com"]

# .dev domain is in Chrome's HSTS Preload List
[[acme.domains]]
   main = "idcrook.dev"
   sans = ["www.idcrook.dev", "github.idcrook.dev", "data.idcrook.dev", "miniflux.idcrook.dev", "api-v1.idcrook.dev"]

# Only DNS challenge with wildcards supports this
# [[acme.domains]]
#    main = "*.idcrook.dev"
